# Switch to ec2-user
sudo su - ec2-user

sudo dnf update -y
sudo dnf install -y git python3.11 python3.11-devel gcc

cd ~
git clone https://github.com/rajeevranjan29/NexDrive1.git
cd NexDrive1

python3.11 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

head -n 15 manage.py | grep DJANGO_SETTINGS_MODULE
Example output: os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'nexdrive.settings')
Project name = nexdrive (use this for Gunicorn)

python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
python manage.py collectstatic

pip install gunicorn

source venv/bin/activate
venv/bin/gunicorn --workers 3 --bind 0.0.0.0:8000 nexdrive.wsgi:application

sudo nano /etc/systemd/system/gunicorn.service

[Unit]
Description=Gunicorn daemon for NexDrive
After=network.target

[Service]
User=ec2-user
Group=ec2-user

WorkingDirectory=/home/ec2-user/NexDrive1
ExecStart=/home/ec2-user/NexDrive1/venv/bin/gunicorn --workers 3 --bind 0.0.0.0:8000 nexdrive.wsgi:application

[Install]
WantedBy=multi-user.target


sudo systemctl daemon-reexec
sudo systemctl start gunicorn
sudo systemctl enable gunicorn
sudo systemctl status gunicorn

sudo dnf install -y nginx
sudo dnf install -y certbot python3-certbot-nginx

sudo systemctl enable nginx
sudo systemctl start nginx

sudo nano /etc/nginx/conf.d/nexdrive.conf

server {
    listen 80;
    server_name estreex.com www.estreex.com;

    location /static/ {
        alias /home/ec2-user/NexDrive1/static/;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

sudo nginx -t
sudo systemctl restart nginx

Obtain SSL certificate using Certbot
sudo certbot --nginx -d estreex.com -d www.estreex.com
